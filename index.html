<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css">

<table id="mytable" style="width:100%">
 <thead>
    <tr>
      <th>Name</th>
      <th>Amount</th>
      <th>Add Item</th>
      <th>Remove Item</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<form id="form">
  <br ><br >
  Add Item: <input type="text" id="newItem" name="item">
  <input type="submit" value="Submit">
</form>

<script src="/socket.io/socket.io.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script src="https://cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>
<script>
  var table;
  var j = 0;
  $('#form').submit(function () {
    console.log("Adding: " + $('#newItem').val())
  	socket.emit('add item', $('#newItem').val())
    $('#newItem').val("")
    return false;
  });

  function add_item(i, num) {
  	name = $("#name_" + i).html()
  	amount = $("#amount_" + i).html()
  	newValue = parseInt(amount) + num
  	console.log("Adding " + num +  " item(s) to " + name + " to make " + newValue + " total items.")
  	socket.emit('set item', [name, newValue])
  	$("#amount_" + i).html(newValue)
  }

  function remove_item(i, num) {
  	name = $("#name_" + i).html()
  	amount = $("#amount_" + i).html()
  	newValue = parseInt(amount) - num
  	console.log("Removing " + num +  " item(s) from " + name + " to make " + newValue + " total items.")
  	socket.emit('set item', [name, newValue])
  	$("#amount_" + i).html(newValue)
  }

  function addRow(data) {
    $('table#mytable').dataTable().fnAddData( [
      "<td class='name' id='name_" + j + "'>" + data[0] + "</td>",
      "<td id='amount_" + j + "'>" + data[1] + "</td>",
      "<td id='add_" + j + "'>" + "<button onclick='add_item(" + j + ", 1)' type='button'>Add 1</button>" + "</td>",
      "<td id='remove_" + j + "'>" + "<button type='button' onclick='remove_item(" + j + ", 1)'>Remove 1</button>" + "</td>" ] );
    j++;
  }

  var socket = io();

  socket.on('set item', function(data) {
    table.column(0).data().each(function (value, index) {
      if (value == data[0]) {
        console.log( 'Data in index: ' + index + ' is: ' + value );
      }
    });
  })

  socket.on('add item', function(data) {
    console.log(data);
    addRow(data);
  })

  socket.emit('get data', "", function(data){
  	console.log(data)
    var tr;
    for (var i = 0; i < data.length; i++) {
      tr = $('<tr/>');
      tr.append("<td class='name' id='name_" + i + "'>" + data[i].name + "</td>");
      tr.append("<td id='amount_" + i + "'>" + data[i].amount + "</td>");
      tr.append("<td id='add_" + i + "'>" + "<button onclick='add_item(" + i + ", 1)' type='button'>Add 1</button>" + "</td>");
      tr.append("<td id='remove_" + i + "'>" + "<button type='button' onclick='remove_item(" + i + ", 1)'>Remove 1</button>" + "</td>");
      $('table tbody').append(tr);
      j = i;
    }
    j++;
    table = $('#mytable').DataTable();
  });
</script>